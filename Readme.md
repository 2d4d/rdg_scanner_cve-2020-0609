# Scanning for Remote Desktop Gateways (Potentially unpatched CVE-2020-0609 and CVE-2020-0610)

According to https://www.kryptoslogic.com/blog/2020/01/rdp-to-rce-when-fragmentation-goes-wrong/ CVE-2020-0609 und 0610 only reside in the UDP code. So it should be enough to scan for UDP 3391 using nmap. At the time of writing this didn't work out of the box. You need to add 3391 to the DTLS section in nmap-payloads (usually in /usr/share/nmap, PR on the way) and scan using e.g.:
```nmap -Pn -p 3391 -sU -oA rdg_scan_yyyymmdd 10.0.0.0/24``` (Needs root permissions)

Not all RD gateways have UDP 3391 active or exposed on the firewall, probably because it also works with HTTPS only and the admins didn't bother to read the documentation. If you also want to find those RD gateways, use the scanner in this repo (Maybe you're afraid of a server with CVE-2020-0609 unpatched and the operators opening UDP 3391 in 6 months because of the "better performance over high latency networks".)

# Usage
```
You can use CIDR notations as well for example: 192.168.1.1/24
You can use hostnames instead of IP addresses also.
You can also use a file with IP addresses generated by an external tool.

Debian/Kali needs: apt-get install python3-netaddr

Example: python3 rdg_scanner_cve-2020-0609.py 192.168.1.1/24 443
Example2: python3 rdg_scanner_cve-2020-0609.py 192.168.1.1 443
Example3: python3 rdg_scanner_cve-2020-0609.py fakewebsiteaddress.com 443
Example4: python3 rdg_scanner_cve-2020-0609.py as15169 443
Example5: python3 rdg_scanner_cve-2020-0609.py 192.168.1.1/24 443 verbose
Example6: python3 rdg_scanner_cve-2020-0609.py file:hostfile 443
     files can contain ips, hostnames, nets or AS

Usage: python3 rdg_scanner_cve-2020-0609.py targetip targetport

usage: rdg_scanner_cve-2020-0609.py [-h] target targetport [verbose]
```

